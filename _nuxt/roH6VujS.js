import{q as R,r as v,s as g,c as h,f as l,t as _,u as m,j as L,e as C,m as T,x as P,y as M,F as E,o as p,w as Y,l as Q,z,A as j,n as N,a as I,d as $,h as J}from"./Ceqlehv_.js";import{g as S}from"./BvJDCSsi.js";import{_ as K}from"./Dl4Sej5e.js";async function X(){const e=await S().from("OEE").select("*").eq("L1_reason","availability").or('L3_reason.is.null, L3_reason.eq.""').order("time",{ascending:!0});if(k(e))throw Error("Failed querying Supabase");const t=e.data,n=se(t);return oe(n)}async function Z(){const e=await S().from("missing_quality_entries").select("*").order("date",{ascending:!0});if(k(e))throw Error("Failed querying Supabase");return e.data}async function ee(r,e,t,n,s){const u=await S().from("machine_quality_by_day").insert({machine:e,date:r,right_first_time_percent:t,number_produced:n,scrap_percent:s});if(k(u))throw Error("Failed querying Supabase")}async function te(r,e,t,n){const a=await(await S()).from("OEE").update({L2_reason:e,L3_reason:t,L4_reason:n}).in("id",r).eq("L1_reason","availability");if(k(a))throw Error("Failed querying Supabase")}function k(r){return!r||r.error}const U=240,ne=U/60;function se(r){const e=r,t=[];for(;e.length>0;){const n=[],s=e.shift(),a=new Date(s.time);for(a.setMinutes(a.getMinutes()+U),n.push(s);e.length>0&&new Date(e[0].time)<a;){let u=e.shift();n.push(u)}t.push(n)}if(t.length>0){const n=t[t.length-1],s=new Date;s.setHours(s.getHours()-4),new Date(n[0].time)>s&&t.splice(-1)}return t}function oe(r){return r.map(e=>{const t=e.map(u=>u.id),n=e[0].time,s=new Date(n);s.setHours(s.getHours()+ne);const a=s.toISOString();return{ids:t,timePeriodStart:n,timePeriodEnd:a,l1Reason:"AVAILABILITY"}})}const ae={class:"flex flex-wrap flex-col my-10 text-2xl"},re={for:"numProduced",class:"h-full my-5"},le={for:"rft",class:"h-full my-5"},ie={for:"scrapPercent",class:"h-full my-5"},ue={class:"h-full text-red-700 my-5"},ce=R({__name:"getQualityInputs",props:["dateNeedingQualityInput","completed"],setup(r){const e=r,t=v(0),n=v(0),s=v(0),a=v(""),u=g(()=>e.dateNeedingQualityInput),y=g(()=>{if(!e.dateNeedingQualityInput)return"";const i=Date.parse(e.dateNeedingQualityInput.date);return isNaN(i)?"":new Date(i).toDateString()});async function b(){if(u){if(t.value===0&&n.value===0){a.value="If you produced 0 items, please set the Right First Time % to 100";return}try{const i=n.value==0||t.value==100?0:s.value;await ee(e.dateNeedingQualityInput.date,e.dateNeedingQualityInput.machine,t.value,n.value,i)}catch(i){console.warn(i),a.value="Problem submitting, please check the values and try again";return}w(),e.completed()}}const w=()=>{t.value=0,n.value=0};return(i,o)=>(p(),h(E,null,[l("div",null,"Please input the results for "+_(e.dateNeedingQualityInput.machine)+" on "+_(m(y)),1),l("form",{onSubmit:o[3]||(o[3]=M((...c)=>i.onSubmit&&i.onSubmit(...c),["prevent"]))},[l("div",ae,[l("label",re,[o[4]||(o[4]=L(" Number of items produced: ")),C(l("input",{type:"number","onUpdate:modelValue":o[0]||(o[0]=c=>P(n)?n.value=c:null),id:"numProduced",class:"w-full text-right placeholder:text-slate-400 text-slate-700 border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow"},null,512),[[T,m(n)]])]),l("label",le,[o[5]||(o[5]=L(" Right first time %: ")),C(l("input",{type:"number","onUpdate:modelValue":o[1]||(o[1]=c=>P(t)?t.value=c:null),id:"rft",class:"w-full text-right placeholder:text-slate-400 text-slate-700 border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow"},null,512),[[T,m(t)]])]),l("label",ie,[o[6]||(o[6]=L(" What % of the defective items are scrap? ")),C(l("input",{type:"number","onUpdate:modelValue":o[2]||(o[2]=c=>P(s)?s.value=c:null),id:"scrapPercent",class:"w-full text-right placeholder:text-slate-400 text-slate-700 border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow"},null,512),[[T,m(s)]])]),l("label",ue,_(m(a)),1),l("span",{class:"h-full"},[l("button",{onClick:b,class:"rounded-3xl bg-green-500 min-h-20 min-w-64 max-w-80 mx-10 my-5"},"Confirm")])])],32)],64))}}),de={class:"flex flex-wrap flex-col my-2"},me={class:"min-w-80 rounded-3xl px-auto mx-auto my-1 min-h-16 flex"},pe=["for"],fe={class:"text-center w-full"},he={class:"flex"},ge=["onClick"],_e=["onUpdate:modelValue","id"],be=["onClick"],ve={class:"h-full text-red-700 my-5"},ye=R({__name:"reasonSelection",props:["possibleReasons"],emits:["confirm"],setup(r,{emit:e}){const t=r,n=e;Y(()=>t.possibleReasons,i=>{a(i)});const s=v([]),a=i=>{i&&(s.value=i.reasons.map(o=>({reason:o,count:0})))};a(t.possibleReasons);const u=i=>{s.value.forEach(o=>{o.reason===i&&o.count>0&&(o.count-=1)})},y=i=>{s.value.forEach(o=>{o.reason===i&&o.count<t.possibleReasons.count&&(o.count+=1)})},b=g(()=>{const i=s.value.reduce((o,c)=>o+c.count,0);return i<t.possibleReasons.count?"Too few reasons provided":i>t.possibleReasons.count?"Too many reasons provided":""}),w=()=>{b.value===""&&n("confirm",s.value)};return(i,o)=>(p(),h("form",{onSubmit:o[0]||(o[0]=M((...c)=>i.onSubmit&&i.onSubmit(...c),["prevent"]))},[l("div",de,[l("div",null,"What caused the "+_(t.possibleReasons.count)+" periods due to "+_(t.possibleReasons.parentReason)+"?",1),(p(!0),h(E,null,Q(s.value,c=>(p(),h("div",me,[l("label",{for:c.reason,class:"text-2xl min-w-60 min-h-16 rounded-3xl h-full flex items-center mx-16"},[l("span",fe,_(c.reason),1)],8,pe),l("div",he,[l("button",{onClick:d=>u(c.reason),class:"mx-auto bg-pulsedarkblue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded my-1 focus:outline-none focus:shadow-outline"},"-",8,ge),C(l("input",{name:"choice",type:"number","onUpdate:modelValue":d=>c.count=d,id:c.reason,class:"w-16 text-center"},null,8,_e),[[T,c.count]]),l("button",{onClick:d=>y(c.reason),class:"mx-auto bg-pulsedarkblue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded my-1 focus:outline-none focus:shadow-outline"},"+",8,be)])]))),256)),l("label",ve,_(m(b)),1),l("button",{onClick:w,class:"rounded-3xl bg-green-500 min-h-20 min-w-64"},"Confirm")])],32))}}),xe={key:0,class:"w-full text-left"},we={class:"flex-grow"},Re={class:"text-right pr-16"},Le={class:""},Ce=R({__name:"lossReasonTreeDisplay",props:["node","depth"],setup(r){const e=r,t=g(()=>e.depth+1),n=g(()=>`padding-left: ${(t.value-1)*4}rem`);return(s,a)=>{const u=z("lossReasonTreeDisplay",!0);return e.node.count>0?(p(),h("div",xe,[l("div",{style:j(m(n)),class:"flex"},[l("span",we,_(e.node.reason)+":",1),l("span",Re,_(e.node.count),1)],4),(p(!0),h(E,null,Q(e.node.children,(y,b)=>(p(),h("div",Le,[N(u,{node:y,depth:m(t)},null,8,["node","depth"])]))),256))])):I("",!0)}}}),Te={class:"flex flex-wrap my-10 flex-col"},Ie={class:"my-8"},Ne=0,Se=R({__name:"reasonConfirmation",props:["reasonTree"],setup(r){const e=r;return(t,n)=>{var a;const s=Ce;return p(),h("div",Te,[N(s,{node:(a=e.reasonTree)==null?void 0:a.head,depth:Ne},null,8,["node"]),l("div",Ie,[l("button",{onClick:n[0]||(n[0]=u=>t.$emit("confirm")),class:"rounded-3xl bg-green-500 min-h-20 min-w-64 max-w-80 mx-10"},"Confirm"),l("button",{onClick:n[1]||(n[1]=u=>t.$emit("restart")),class:"rounded-3xl bg-red-500 min-h-20 min-w-64 max-w-80 mx-10"},"Restart")])])}}}),V=[{reason:"Pump 1",count:0},{reason:"Compressor 1",count:0}],B=[{reason:"Pump 2",count:0},{reason:"Motor 1",count:0}],A=[{reason:"Motor 2",count:0},{reason:"Compressor 2",count:0}],O=[{reason:"Motor 3",count:0},{reason:"Motor 4",count:0}],H=[{reason:"Pump 3",count:0},{reason:"Pump 4",count:0}],ke=[{reason:"Upstream",count:0,children:structuredClone(V)},{reason:"Downstream",count:0,children:structuredClone(B)},{reason:"Bottleneck",count:0,children:structuredClone(A)},{reason:"Utilities",count:0,children:structuredClone(O)},{reason:"Waste Processing",count:0,children:structuredClone(H)}],De=[{reason:"Upstream",count:0,children:structuredClone(V)},{reason:"Downstream",count:0,children:structuredClone(B)},{reason:"Bottleneck",count:0,children:structuredClone(A)},{reason:"Utilities",count:0,children:structuredClone(O)},{reason:"Waste Processing",count:0,children:structuredClone(H)}],Pe=[{reason:"Planned Breaks",count:0},{reason:"Product Demand",count:0},{reason:"Equipment Failure",count:0,children:structuredClone(ke)},{reason:"Planned Maintenance",count:0,children:structuredClone(De)},{reason:"Waiting for Material",count:0},{reason:"Waiting for Operator",count:0},{reason:"Cleaning",count:0},{reason:"Changeovers",count:0},{reason:"Training",count:0}],F=r=>({head:{reason:"Unavailability",count:r,children:structuredClone(Pe)}}),q=r=>{const e=t=>{if(t.count==0||!t.children)return null;if(t.children.reduce((s,a)=>s+a.count,0)!=t.count)return t;for(let s=0;s<t.children.length;s++){const a=t.children[s],u=e(a);if(u!=null)return u}return null};return e(r.head)},$e=r=>{const e=q(r);return e===null||!e.children?null:{parentReason:e.reason,reasons:e.children.map(t=>t.reason),count:e.count}},Ee=(r,e)=>{var n;const t=q(r);(n=t==null?void 0:t.children)==null||n.forEach(s=>{const a=e.get(s.reason);a&&(s.count=a)})},W=r=>q(r)===null,qe=r=>{if(!W(r))return[];const e=[],t=(n,s)=>{if(!n.children){const a=[...s];for(;a.length<3;)a.push(n.reason);for(let u=0;u<n.count;u++)e.push(a);return}n.children.forEach(a=>{const u=[...s,a.reason];t(a,u)})};return t(r.head,[]),e},Fe={key:0},Me={key:1},Qe=R({__name:"getLossReasons",props:["timespanRequiringLossReasons","completed"],setup(r){const e=r,t=g(()=>e.timespanRequiringLossReasons),n=g(()=>e.timespanRequiringLossReasons.ids.length),s=v(F(n.value)),a=v(!1),u=g(()=>t?new Date(e.timespanRequiringLossReasons.timePeriodStart).toLocaleTimeString():""),y=g(()=>{if(!t)return"";const d=new Date(e.timespanRequiringLossReasons.timePeriodEnd),f=new Date;return d.getFullYear()===f.getFullYear()&&d.getMonth()===f.getMonth()&&d.getDate()===f.getDate()?d.toLocaleTimeString()+" today":d.toLocaleTimeString()+" on "+d.toLocaleDateString()});async function b(){try{if(!c||a.value)return;a.value=!0;const d=qe(s.value);if(d.length!=e.timespanRequiringLossReasons.ids.length)throw console.log(d),console.log(e.timespanRequiringLossReasons),Error("Wrong number of entries, abandoning");for(let f=0;f<d.length;f++){const x=d[f],D=[e.timespanRequiringLossReasons.ids[f]];await te(D,x[0],x[1],x[2])}w(),e.completed(),a.value=!1}catch(d){console.warn(d),alert("There was an error submitting that data, please try again soon"),a.value=!1}}function w(){s.value=F(n.value)}function i(d){const f=new Map;d.forEach(x=>{f.set(x.reason,x.count)}),Ee(s.value,f)}const o=g(()=>$e(s.value)),c=g(()=>W(s.value));return(d,f)=>{const x=ye,D=K,G=Se;return m(t)?(p(),h("div",Fe,[l("div",null,[l("div",null,[f[0]||(f[0]=L("The machine was stopped for a total of ")),l("b",null,_(m(n)),1),L(" 15 minute periods between "+_(m(u))+" and "+_(m(y))+".",1)])]),m(c)?I("",!0):(p(),$(x,{key:0,possibleReasons:m(o),onConfirm:i},null,8,["possibleReasons"])),m(c)?(p(),h("div",Me,[m(a)?(p(),$(D,{key:0})):(p(),$(G,{key:1,reasonTree:m(s),onConfirm:b,onRestart:w},null,8,["reasonTree"]))])):I("",!0)])):I("",!0)}}}),Ue=window.setInterval,Ve={class:"grid w-full gap-1 grid-rows-[auto_1fr] divide-y-4"},Be={class:"grow bg-white shadow-md rounded px-8 pb-8 mb-4 w-fit m-auto my-8 text-lg"},Ae={key:0,class:"text-2xl text-center text-red-700 flex-col"},Oe={class:"h-full my-10"},He={key:1,class:"text-2xl text-center text-black"},We={key:2,class:"text-2xl text-center text-black"},Ge={key:3,class:"text-2xl"},Ye=1e3*60*10,Ke=R({__name:"input",setup(r){const e=v(null),t=g(()=>e.value&&e.value.length>0?e.value[0]:null),n=v(null),s=g(()=>n.value&&n.value.length>0?n.value[0]:null),a=v(""),u=async()=>{try{const o=await X();o!==null&&(e.value=o)}catch(o){console.warn(o),a.value="Problem loading data"}},y=async()=>{try{const o=await Z();o!==null&&(n.value=o)}catch(o){console.warn(o),a.value="Problem loading data"}},b=async()=>{u(),y()};b(),J(()=>{Ue(b,Ye)});const w=()=>{e.value===null||e.value.length===0||e.value.shift()},i=()=>{var o;n&&((o=n.value)==null||o.shift())};return(o,c)=>{const d=ce,f=Qe;return p(),h("div",Ve,[l("div",Be,[a.value?(p(),h("div",Ae,[l("div",Oe,_(a.value),1),l("button",{onClick:b,class:"rounded-3xl bg-red-500 min-h-20 min-w-64 max-w-80 mx-10 text-black"},"Try again")])):m(s)!==null?(p(),h("div",He,[N(d,{dateNeedingQualityInput:m(s),completed:i},null,8,["dateNeedingQualityInput"])])):m(t)!==null?(p(),h("div",We,[N(f,{timespanRequiringLossReasons:m(t),completed:w},null,8,["timespanRequiringLossReasons"])])):(p(),h("div",Ge," All data is up to date. "))])])}}});export{Ke as default};
