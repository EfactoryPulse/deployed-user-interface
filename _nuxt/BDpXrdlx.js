import{r as S,o as i,c,d,F as x,l as I,q as W,t as f,f as $,s as B,u as o,x as F,j as C,a as p,y as U,z as g,e as T}from"./Bme1nsX4.js";import{g as D}from"./B4XQBcx3.js";const G={class:"flex flex-wrap my-10"},H=["for"],V={class:"text-center w-full"},q=["value","id"],Y={__name:"reasonSelection",props:["reasons","choice"],setup(e){const s=e.reasons,t=S("");return(n,l)=>(i(),c("form",{onSubmit:l[2]||(l[2]=F((...u)=>n.onSubmit&&n.onSubmit(...u),["prevent"]))},[d("div",G,[(i(!0),c(x,null,I(o(s),u=>(i(),c("div",{class:W(["min-w-80 rounded-3xl px-auto mx-auto my-2 min-h-36",{"bg-pulsedarkblue":t.value===u,"bg-pulseblue":t.value!==u}])},[d("label",{for:u,class:"text-2xl h-full flex items-center"},[d("span",V,f(u),1),$(d("input",{name:"choice",type:"radio","onUpdate:modelValue":l[0]||(l[0]=_=>t.value=_),value:u,id:u,hidden:""},null,8,q),[[B,t.value]])],8,H)],2))),256))]),d("button",{onClick:l[1]||(l[1]=u=>n.$emit("update",t.value)),class:"rounded-3xl bg-green-500 min-h-20 min-w-64"},"Confirm")],32))}},j={class:"flex flex-wrap my-10 flex-col"},z={class:"my-2 flex"},K={key:0},J={key:1},Q={class:"text-align-right flex-grow"},X={class:"my-8"},Z={__name:"reasonConfirmation",props:["reasons","l1","startTime","endTime"],setup(e){return(a,s)=>(i(),c("div",j,[C(" This machine was "+f(e.l1)+" between "+f(e.startTime)+" and "+f(e.endTime)+". ",1),(i(!0),c(x,null,I(e.reasons,(t,n)=>(i(),c("div",z,[n===0?(i(),c("span",K,"Because of:")):p("",!0),n>0?(i(),c("span",J,"Caused by:")):p("",!0),d("span",Q,f(t),1)]))),256)),d("div",X,[d("button",{onClick:s[0]||(s[0]=t=>a.$emit("confirm")),class:"rounded-3xl bg-green-500 min-h-20 min-w-64 max-w-80 mx-10"},"Confirm"),d("button",{onClick:s[1]||(s[1]=t=>a.$emit("restart")),class:"rounded-3xl bg-red-500 min-h-20 min-w-64 max-w-80 mx-10"},"Restart")])]))}},A=240,ee=A/60;function te(e){const a=e,s=[];for(;a.length>0;){const t=[],n=a.shift(),l=new Date(n.time);for(l.setMinutes(l.getMinutes()+A),t.push(n);a.length>0&&new Date(a[0].time)<l;){let u=a.shift();t.push(u)}s.push(t)}if(s.length>0){const t=s[s.length-1],n=new Date;n.setHours(n.getHours()-4),new Date(t[0].time)>n&&s.splice(-1)}return s}function ne(e){return e.map(a=>{const s=a.map(E=>E.id),t=a[0].time,n=new Date(t);n.setHours(n.getHours()+ee);const l=n.toISOString(),_=a.filter(E=>E.L1_reason==="availability").length>0?"AVAILABILITY":"SPEED";return{ids:s,timePeriodStart:t,timePeriodEnd:l,l1Reason:_}})}async function ae(){const s=(await D().from("OEE").select("*").or('L3_reason.is.null, L3_reason.eq.""').order("time",{ascending:!0})).data,t=te(s);return ne(t)}async function se(e,a,s,t){const n=await D();await n.from("OEE").update({L2_reason:a,L3_reason:s,L4_reason:t}).in("id",e).eq("L1_reason","availability"),await n.from("OEE").update({L3_reason:s,L4_reason:t}).in("id",e).eq("L1_reason","speed")}var O=(e=>(e.WAITING_FOR_MATERIAL="Waiting for Material",e.OPERATOR_SHORTAGE="Operator Shortage",e.MACHINE_BREAKDOWN="Machine Breakdown",e.PROCESS_DOWNTIME="Process Downtime",e.CHANGEOVERS="Changeovers",e.TRAINING="Training",e.CLEANING="Cleaning",e.LOW_SPEED="Low Speed",e.MINOR_STOP="Minor Stop (<5 mins)",e))(O||{});const re=e=>e==="AVAILABILITY"?["Waiting for Material","Operator Shortage","Machine Breakdown","Process Downtime","Changeovers","Training","Cleaning"]:e==="SPEED"?["Low Speed","Minor Stop (<5 mins)"]:Object.values(O);var R=(e=>(e.UPSTREAM="Upstream",e.DOWNSTREAM="Downstream",e.BOTTLENECK="Bottleneck",e.UTILITIES="Utilities",e.WASTE_PROCESSING="Waste Processing",e))(R||{}),M=(e=>(e.PUMP_1="Pump 1",e.PUMP_2="Pump 2",e.COMPRESSOR_1="Compressor 1",e.COMPRESSOR_2="Compressor 2",e.WELDER_1="Welder 1",e.WELDER_2="Welder 2",e))(M||{});const oe={class:"grid w-full gap-1 grid-rows-[auto_1fr] divide-y-4"},ie={class:"grow bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4 w-fit m-auto my-28 text-lg"},le={key:0,class:"text-2xl text-center text-black"},ue={key:0},de={key:1,class:"text-2xl"},fe=U({__name:"input",setup(e){const a=S(null),s=async()=>{const r=await ae();r!==null&&(a.value=r,t.value.l1Reason==="SPEED"&&(v.value=O.LOW_SPEED))};s();const t=g(()=>a.value&&a.value.length>0?a.value[0]:null),n=g(()=>t===null?null:v.value===""?2:w.value===""?3:h.value===""?4:null),l=g(()=>t.value===null?"":t.value.l1Reason==="AVAILABILITY"?"unavailable at times":t.value.l1Reason==="SPEED"?"running slow":"disrupted"),u=g(()=>t.value===null?[]:re(t.value.l1Reason)),_=g(()=>t.value===null?"":new Date(t.value.timePeriodStart).toLocaleTimeString()),E=g(()=>{if(t.value===null)return"";const r=new Date(t.value.timePeriodEnd),m=new Date;return r.getFullYear()===m.getFullYear()&&r.getMonth()===m.getMonth()&&r.getDate()===m.getDate()?r.toLocaleTimeString()+" today":r.toLocaleTimeString()+" on "+r.toLocaleDateString()}),v=S(""),w=S(""),h=S("");async function k(){t.value!==null&&(await se(t.value.ids,v.value,w.value,h.value),P(),a.value!==null&&(a.value.shift(),t.value.l1Reason==="SPEED"&&(v.value=O.LOW_SPEED)))}function P(){v.value="",w.value="",h.value=""}function y(r){if(n.value===2){v.value=r;return}if(n.value===3){w.value=r;return}if(n.value===4){h.value=r;return}}const N=async()=>{const r=await D();await r.from("OEE").update({l2_reason:null,l3_reason:null,l4_reason:null}).in("id",["53d543e5-1d54-4bf0-b054-b71357363dd1","7fca4c35-9d51-43e7-aa60-d9234fe059d9","751ac9e3-a11c-4c21-a94c-4b7512af5b57","35b144ff-d64d-47c7-a966-1309de4e2dad"]),await r.from("OEE").update({l2_reason:"LOW SPEED"}).in("id",["7fca4c35-9d51-43e7-aa60-d9234fe059d9","751ac9e3-a11c-4c21-a94c-4b7512af5b57"]),s()};return(r,m)=>{const b=Y,L=Z;return i(),c("div",oe,[d("div",ie,[o(t)!==null?(i(),c("div",le,[o(n)!==null?(i(),c("div",ue,[d("div",null,"We detected that the machine was "+f(o(l))+" between "+f(o(_))+" and "+f(o(E))+".",1),m[0]||(m[0]=d("div",null,"Why was that?",-1))])):p("",!0),o(n)===2?(i(),T(b,{key:1,reasons:o(u),onUpdate:y},null,8,["reasons"])):p("",!0),o(n)===3?(i(),T(b,{key:2,reasons:o(R),onUpdate:y},null,8,["reasons"])):p("",!0),o(n)===4?(i(),T(b,{key:3,reasons:o(M),onUpdate:y},null,8,["reasons"])):p("",!0),o(n)===null?(i(),T(L,{key:4,reasons:[v.value,w.value,h.value],l1:o(l),startTime:o(_),endTime:o(E),onConfirm:k,onRestart:P},null,8,["reasons","l1","startTime","endTime"])):p("",!0)])):(i(),c("div",de,[m[1]||(m[1]=C(" All data is up to date. ")),d("button",{onClick:N,class:"rounded-3xl bg-red-500 min-h-20 min-w-64 max-w-80 mx-10"},"Reset for debugging")]))])])}}});export{fe as default};
