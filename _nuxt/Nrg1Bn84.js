import{q as L,r as y,s as _,c as p,d as l,t as g,u as i,j as P,f as D,m as C,x as A,y as M,F as T,o as d,l as q,z as U,A as W,a as b,e as E,h as V,n as k}from"./eclg-HJz.js";import{g as I}from"./Ds1ieqTk.js";async function G(){const t=await I().from("OEE").select("*").or('L3_reason.is.null, L3_reason.eq.""').order("time",{ascending:!0});if(x(t))throw Error("Failed querying Supabase");const s=t.data,n=K(s);return J(n)}async function H(){const t=await I().from("missing_quality_entries").select("*").order("date",{ascending:!0});if(x(t))throw Error("Failed querying Supabase");return t.data}async function Y(e,t,s,n){const o=await I().from("machine_quality_by_day").insert({machine:t,date:e,right_first_time_percent:s,number_produced:n});if(x(o))throw Error("Failed querying Supabase")}async function j(e,t,s,n){const a=await I(),o=await a.from("OEE").update({L2_reason:t,L3_reason:s,L4_reason:n}).in("id",e).eq("L1_reason","availability"),r=await a.from("OEE").update({L3_reason:s,L4_reason:n}).in("id",e).eq("L1_reason","speed");if(x(o)||x(r))throw Error("Failed querying Supabase")}function x(e){return!e||e.error}const $=240,z=$/60;function K(e){const t=e,s=[];for(;t.length>0;){const n=[],a=t.shift(),o=new Date(a.time);for(o.setMinutes(o.getMinutes()+$),n.push(a);t.length>0&&new Date(t[0].time)<o;){let r=t.shift();n.push(r)}s.push(n)}if(s.length>0){const n=s[s.length-1],a=new Date;a.setHours(a.getHours()-4),new Date(n[0].time)>a&&s.splice(-1)}return s}function J(e){return e.map(t=>{const s=t.map(h=>h.id),n=t[0].time,a=new Date(n);a.setHours(a.getHours()+z);const o=a.toISOString(),v=t.filter(h=>h.L1_reason==="availability").length>0?"AVAILABILITY":"SPEED";return{ids:s,timePeriodStart:n,timePeriodEnd:o,l1Reason:v}})}const X={class:"flex flex-wrap flex-col my-10 text-2xl"},Z={for:"rft",class:"h-full my-5"},ee={for:"numProduced",class:"h-full my-5"},te={class:"h-full text-red-700 my-5"},ne=L({__name:"getQualityInputs",props:["dateNeedingQualityInput","completed"],setup(e){const t=e,s=y(0),n=y(0),a=y(""),o=_(()=>t.dateNeedingQualityInput),r=_(()=>{if(!t.dateNeedingQualityInput)return"";const f=Date.parse(t.dateNeedingQualityInput.date);return isNaN(f)?"":new Date(f).toDateString()});async function v(){if(o){if(s.value===0&&n.value===0){a.value="If you produced 0 items, please set the Right First Time % to 100";return}try{await Y(t.dateNeedingQualityInput.date,t.dateNeedingQualityInput.machine,s.value,n.value)}catch(f){console.warn(f),a.value="Problem submitting, please check the values and try again";return}h(),t.completed()}}const h=()=>{s.value=0,n.value=0};return(f,c)=>(d(),p(T,null,[l("div",null,"Please input the results for "+g(t.dateNeedingQualityInput.machine)+" on "+g(i(r)),1),l("form",{onSubmit:c[2]||(c[2]=M((...u)=>f.onSubmit&&f.onSubmit(...u),["prevent"]))},[l("div",X,[l("label",Z,[c[3]||(c[3]=P(" Right first time %: ")),D(l("input",{type:"number","onUpdate:modelValue":c[0]||(c[0]=u=>A(s)?s.value=u:null),id:"rft",class:"w-full text-right placeholder:text-slate-400 text-slate-700 border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow"},null,512),[[C,i(s)]])]),l("label",ee,[c[4]||(c[4]=P(" Number of items produced: ")),D(l("input",{type:"number","onUpdate:modelValue":c[1]||(c[1]=u=>A(n)?n.value=u:null),id:"numProduced",class:"w-full text-right placeholder:text-slate-400 text-slate-700 border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow"},null,512),[[C,i(n)]])]),l("label",te,g(i(a)),1),l("span",{class:"h-full"},[l("button",{onClick:v,class:"rounded-3xl bg-green-500 min-h-20 min-w-64 max-w-80 mx-10 my-5"},"Confirm")])])],32)],64))}}),se={class:"flex flex-wrap my-10"},ae=["for"],oe={class:"text-center w-full"},re=["value","id"],ie={__name:"reasonSelection",props:["reasons","choice"],setup(e){const s=e.reasons,n=y("");return(a,o)=>(d(),p("form",{onSubmit:o[2]||(o[2]=M((...r)=>a.onSubmit&&a.onSubmit(...r),["prevent"]))},[l("div",se,[(d(!0),p(T,null,q(i(s),r=>(d(),p("div",{class:U(["min-w-80 rounded-3xl px-auto mx-auto my-2 min-h-36",{"bg-pulsedarkblue":n.value===r,"bg-pulseblue":n.value!==r}])},[l("label",{for:r,class:"text-2xl h-full flex items-center"},[l("span",oe,g(r),1),D(l("input",{name:"choice",type:"radio","onUpdate:modelValue":o[0]||(o[0]=v=>n.value=v),value:r,id:r,hidden:""},null,8,re),[[W,n.value]])],8,ae)],2))),256))]),l("button",{onClick:o[1]||(o[1]=r=>a.$emit("update",n.value)),class:"rounded-3xl bg-green-500 min-h-20 min-w-64"},"Confirm")],32))}},le={class:"flex flex-wrap my-10 flex-col"},ue={class:"my-2 flex"},de={key:0},ce={key:1},me={class:"text-align-right flex-grow"},pe={class:"my-8"},fe={__name:"reasonConfirmation",props:["reasons","l1","startTime","endTime"],setup(e){return(t,s)=>(d(),p("div",le,[P(" This machine was "+g(e.l1)+" between "+g(e.startTime)+" and "+g(e.endTime)+". ",1),(d(!0),p(T,null,q(e.reasons,(n,a)=>(d(),p("div",ue,[a===0?(d(),p("span",de,"Because of:")):b("",!0),a>0?(d(),p("span",ce,"Caused by:")):b("",!0),l("span",me,g(n),1)]))),256)),l("div",pe,[l("button",{onClick:s[0]||(s[0]=n=>t.$emit("confirm")),class:"rounded-3xl bg-green-500 min-h-20 min-w-64 max-w-80 mx-10"},"Confirm"),l("button",{onClick:s[1]||(s[1]=n=>t.$emit("restart")),class:"rounded-3xl bg-red-500 min-h-20 min-w-64 max-w-80 mx-10"},"Restart")])]))}};var O=(e=>(e.WAITING_FOR_MATERIAL="Waiting for Material",e.OPERATOR_SHORTAGE="Operator Shortage",e.MACHINE_BREAKDOWN="Machine Breakdown",e.PROCESS_DOWNTIME="Process Downtime",e.CHANGEOVERS="Changeovers",e.TRAINING="Training",e.CLEANING="Cleaning",e.LOW_SPEED="Low Speed",e.MINOR_STOP="Minor Stop (<5 mins)",e))(O||{});const ge=e=>e==="AVAILABILITY"?["Waiting for Material","Operator Shortage","Machine Breakdown","Process Downtime","Changeovers","Training","Cleaning"]:e==="SPEED"?["Low Speed","Minor Stop (<5 mins)"]:Object.values(O);var F=(e=>(e.UPSTREAM="Upstream",e.DOWNSTREAM="Downstream",e.BOTTLENECK="Bottleneck",e.UTILITIES="Utilities",e.WASTE_PROCESSING="Waste Processing",e))(F||{}),B=(e=>(e.PUMP_1="Pump 1",e.PUMP_2="Pump 2",e.COMPRESSOR_1="Compressor 1",e.COMPRESSOR_2="Compressor 2",e.WELDER_1="Welder 1",e.WELDER_2="Welder 2",e))(B||{});const he={key:0},ve=L({__name:"getLossReasons",props:["timespanRequiringLossReasons","completed"],setup(e){const t=e,s=y(""),n=y(""),a=y("");t.timespanRequiringLossReasons&&t.timespanRequiringLossReasons.l1Reason==="SPEED"&&(s.value=O.LOW_SPEED);const o=_(()=>t.timespanRequiringLossReasons),r=_(()=>o?s.value===""?2:n.value===""?3:a.value===""?4:null:null),v=_(()=>o?t.timespanRequiringLossReasons.l1Reason==="AVAILABILITY"?"unavailable at times":t.timespanRequiringLossReasons.l1Reason==="SPEED"?"running slow":"disrupted":""),h=_(()=>o?ge(t.timespanRequiringLossReasons.l1Reason):[]),f=_(()=>o?new Date(t.timespanRequiringLossReasons.timePeriodStart).toLocaleTimeString():""),c=_(()=>{if(!o)return"";const m=new Date(t.timespanRequiringLossReasons.timePeriodEnd),w=new Date;return m.getFullYear()===w.getFullYear()&&m.getMonth()===w.getMonth()&&m.getDate()===w.getDate()?m.toLocaleTimeString()+" today":m.toLocaleTimeString()+" on "+m.toLocaleDateString()});async function u(){try{if(!o)return;await j(t.timespanRequiringLossReasons.ids,s.value,n.value,a.value),N(),t.completed()}catch(m){console.warn(m),alert("There was an error submitting that data, please try again soon")}}function N(){s.value="",n.value="",a.value=""}function R(m){if(r.value===2){s.value=m;return}if(r.value===3){n.value=m;return}if(r.value===4){a.value=m;return}}return(m,w)=>{const S=ie,Q=fe;return d(),p(T,null,[i(r)!==null?(d(),p("div",he,[l("div",null,"We detected that the machine was "+g(i(v))+" between "+g(i(f))+" and "+g(i(c))+".",1),w[0]||(w[0]=l("div",null,"Why was that?",-1))])):b("",!0),i(r)===2?(d(),E(S,{key:1,reasons:i(h),onUpdate:R},null,8,["reasons"])):b("",!0),i(r)===3?(d(),E(S,{key:2,reasons:i(F),onUpdate:R},null,8,["reasons"])):b("",!0),i(r)===4?(d(),E(S,{key:3,reasons:i(B),onUpdate:R},null,8,["reasons"])):b("",!0),i(r)===null?(d(),E(Q,{key:4,reasons:[i(s),i(n),i(a)],l1:i(v),startTime:i(f),endTime:i(c),onConfirm:u,onRestart:N},null,8,["reasons","l1","startTime","endTime"])):b("",!0)],64)}}}),_e=window.setInterval,ye={class:"grid w-full gap-1 grid-rows-[auto_1fr] divide-y-4"},be={class:"grow bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4 w-fit m-auto my-28 text-lg"},we={key:0,class:"text-2xl text-center text-red-700 flex-col"},Re={class:"h-full my-10"},xe={key:1,class:"text-2xl text-center text-black"},Se={key:2,class:"text-2xl text-center text-black"},Ee={key:3,class:"text-2xl"},Te=1e3*60*10,Pe=L({__name:"input",setup(e){const t=y(null),s=_(()=>t.value&&t.value.length>0?t.value[0]:null),n=y(null),a=_(()=>n.value&&n.value.length>0?n.value[0]:null),o=y(""),r=async()=>{try{const u=await G();u!==null&&(t.value=u)}catch(u){console.warn(u),o.value="Problem loading data"}},v=async()=>{try{const u=await H();u!==null&&(n.value=u)}catch(u){console.warn(u),o.value="Problem loading data"}},h=async()=>{r(),v()};h(),V(()=>{_e(h,Te)});const f=()=>{t.value===null||t.value.length===0||t.value.shift()},c=()=>{var u;n&&((u=n.value)==null||u.shift())};return(u,N)=>{const R=ne,m=ve;return d(),p("div",ye,[l("div",be,[o.value?(d(),p("div",we,[l("div",Re,g(o.value),1),l("button",{onClick:h,class:"rounded-3xl bg-red-500 min-h-20 min-w-64 max-w-80 mx-10 text-black"},"Try again")])):i(a)!==null?(d(),p("div",xe,[k(R,{dateNeedingQualityInput:i(a),completed:c},null,8,["dateNeedingQualityInput"])])):i(s)!==null?(d(),p("div",Se,[k(m,{timespanRequiringLossReasons:i(s),completed:f},null,8,["timespanRequiringLossReasons"])])):(d(),p("div",Ee," All data is up to date. "))])])}}});export{Pe as default};
