import{q as L,r as v,s as _,c,d as u,t as g,j as I,f as N,m as O,u as i,x as C,y as M,F as S,o as d,l as k,z as F,A as Q,a as h,e as E,h as U,n as A}from"./KHRXC8Hd.js";import{g as T}from"./CzBrfFY6.js";const q=240,V=q/60;function G(e){const t=e,s=[];for(;t.length>0;){const n=[],a=t.shift(),r=new Date(a.time);for(r.setMinutes(r.getMinutes()+q),n.push(a);t.length>0&&new Date(t[0].time)<r;){let o=t.shift();n.push(o)}s.push(n)}if(s.length>0){const n=s[s.length-1],a=new Date;a.setHours(a.getHours()-4),new Date(n[0].time)>a&&s.splice(-1)}return s}function H(e){return e.map(t=>{const s=t.map(m=>m.id),n=t[0].time,a=new Date(n);a.setHours(a.getHours()+V);const r=a.toISOString(),l=t.filter(m=>m.L1_reason==="availability").length>0?"AVAILABILITY":"SPEED";return{ids:s,timePeriodStart:n,timePeriodEnd:r,l1Reason:l}})}async function Y(){const s=(await T().from("OEE").select("*").or('L3_reason.is.null, L3_reason.eq.""').order("time",{ascending:!0})).data,n=G(s);return H(n)}async function j(){return(await T().from("missing_quality_entries").select("*").order("date",{ascending:!0})).data}async function z(e,t,s,n){await T().from("machine_quality_by_day").insert({machine:t,date:e,right_first_time_percent:s,number_produced:n})}async function K(e,t,s,n){const a=await T();await a.from("OEE").update({L2_reason:t,L3_reason:s,L4_reason:n}).in("id",e).eq("L1_reason","availability"),await a.from("OEE").update({L3_reason:s,L4_reason:n}).in("id",e).eq("L1_reason","speed")}const J={class:"flex flex-wrap my-10"},X={for:"rft",class:"text-2xl h-full"},Z={for:"numProduced",class:"text-2xl h-full"},ee=L({__name:"getQualityInputs",props:["dateNeedingQualityInput","completed"],setup(e){const t=e,s=v(0),n=v(0),a=_(()=>t.dateNeedingQualityInput);async function r(){a&&(await z(t.dateNeedingQualityInput.date,t.dateNeedingQualityInput.machine,s.value,n.value),t.completed())}return(o,l)=>(d(),c(S,null,[u("div",null,"How did "+g(t.dateNeedingQualityInput.machine)+" work on "+g(t.dateNeedingQualityInput.date)+"?",1),u("form",{onSubmit:l[2]||(l[2]=M((...m)=>o.onSubmit&&o.onSubmit(...m),["prevent"]))},[u("div",J,[u("label",X,[l[3]||(l[3]=I(" Right first time %: ")),N(u("input",{type:"number","onUpdate:modelValue":l[0]||(l[0]=m=>C(s)?s.value=m:null),id:"rft",class:"w-full text-right placeholder:text-slate-400 text-slate-700 border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow"},null,512),[[O,i(s)]])]),u("label",Z,[l[4]||(l[4]=I(" Number of items produced: ")),N(u("input",{type:"number","onUpdate:modelValue":l[1]||(l[1]=m=>C(n)?n.value=m:null),id:"numProduced",class:"w-full text-right placeholder:text-slate-400 text-slate-700 border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow"},null,512),[[O,i(n)]])]),u("button",{onClick:r,class:"rounded-3xl bg-green-500 min-h-20 min-w-64 max-w-80 mx-10"},"Confirm")])],32)],64))}}),te={class:"flex flex-wrap my-10"},ne=["for"],se={class:"text-center w-full"},ae=["value","id"],oe={__name:"reasonSelection",props:["reasons","choice"],setup(e){const s=e.reasons,n=v("");return(a,r)=>(d(),c("form",{onSubmit:r[2]||(r[2]=M((...o)=>a.onSubmit&&a.onSubmit(...o),["prevent"]))},[u("div",te,[(d(!0),c(S,null,k(i(s),o=>(d(),c("div",{class:F(["min-w-80 rounded-3xl px-auto mx-auto my-2 min-h-36",{"bg-pulsedarkblue":n.value===o,"bg-pulseblue":n.value!==o}])},[u("label",{for:o,class:"text-2xl h-full flex items-center"},[u("span",se,g(o),1),N(u("input",{name:"choice",type:"radio","onUpdate:modelValue":r[0]||(r[0]=l=>n.value=l),value:o,id:o,hidden:""},null,8,ae),[[Q,n.value]])],8,ne)],2))),256))]),u("button",{onClick:r[1]||(r[1]=o=>a.$emit("update",n.value)),class:"rounded-3xl bg-green-500 min-h-20 min-w-64"},"Confirm")],32))}},ie={class:"flex flex-wrap my-10 flex-col"},re={class:"my-2 flex"},le={key:0},ue={key:1},de={class:"text-align-right flex-grow"},ce={class:"my-8"},me={__name:"reasonConfirmation",props:["reasons","l1","startTime","endTime"],setup(e){return(t,s)=>(d(),c("div",ie,[I(" This machine was "+g(e.l1)+" between "+g(e.startTime)+" and "+g(e.endTime)+". ",1),(d(!0),c(S,null,k(e.reasons,(n,a)=>(d(),c("div",re,[a===0?(d(),c("span",le,"Because of:")):h("",!0),a>0?(d(),c("span",ue,"Caused by:")):h("",!0),u("span",de,g(n),1)]))),256)),u("div",ce,[u("button",{onClick:s[0]||(s[0]=n=>t.$emit("confirm")),class:"rounded-3xl bg-green-500 min-h-20 min-w-64 max-w-80 mx-10"},"Confirm"),u("button",{onClick:s[1]||(s[1]=n=>t.$emit("restart")),class:"rounded-3xl bg-red-500 min-h-20 min-w-64 max-w-80 mx-10"},"Restart")])]))}};var D=(e=>(e.WAITING_FOR_MATERIAL="Waiting for Material",e.OPERATOR_SHORTAGE="Operator Shortage",e.MACHINE_BREAKDOWN="Machine Breakdown",e.PROCESS_DOWNTIME="Process Downtime",e.CHANGEOVERS="Changeovers",e.TRAINING="Training",e.CLEANING="Cleaning",e.LOW_SPEED="Low Speed",e.MINOR_STOP="Minor Stop (<5 mins)",e))(D||{});const pe=e=>e==="AVAILABILITY"?["Waiting for Material","Operator Shortage","Machine Breakdown","Process Downtime","Changeovers","Training","Cleaning"]:e==="SPEED"?["Low Speed","Minor Stop (<5 mins)"]:Object.values(D);var $=(e=>(e.UPSTREAM="Upstream",e.DOWNSTREAM="Downstream",e.BOTTLENECK="Bottleneck",e.UTILITIES="Utilities",e.WASTE_PROCESSING="Waste Processing",e))($||{}),B=(e=>(e.PUMP_1="Pump 1",e.PUMP_2="Pump 2",e.COMPRESSOR_1="Compressor 1",e.COMPRESSOR_2="Compressor 2",e.WELDER_1="Welder 1",e.WELDER_2="Welder 2",e))(B||{});const fe={key:0},ge=L({__name:"getLossReasons",props:["timespanRequiringLossReasons","completed"],setup(e){const t=e,s=v(""),n=v(""),a=v("");t.timespanRequiringLossReasons&&t.timespanRequiringLossReasons.l1Reason==="SPEED"&&(s.value=D.LOW_SPEED);const r=_(()=>t.timespanRequiringLossReasons),o=_(()=>r?s.value===""?2:n.value===""?3:a.value===""?4:null:null),l=_(()=>r?t.timespanRequiringLossReasons.l1Reason==="AVAILABILITY"?"unavailable at times":t.timespanRequiringLossReasons.l1Reason==="SPEED"?"running slow":"disrupted":""),m=_(()=>r?pe(t.timespanRequiringLossReasons.l1Reason):[]),b=_(()=>r?new Date(t.timespanRequiringLossReasons.timePeriodStart).toLocaleTimeString():""),p=_(()=>{if(!r)return"";const f=new Date(t.timespanRequiringLossReasons.timePeriodEnd),w=new Date;return f.getFullYear()===w.getFullYear()&&f.getMonth()===w.getMonth()&&f.getDate()===w.getDate()?f.toLocaleTimeString()+" today":f.toLocaleTimeString()+" on "+f.toLocaleDateString()});async function P(){r&&(await K(t.timespanRequiringLossReasons.ids,s.value,n.value,a.value),R(),t.completed())}function R(){s.value="",n.value="",a.value=""}function y(f){if(o.value===2){s.value=f;return}if(o.value===3){n.value=f;return}if(o.value===4){a.value=f;return}}return(f,w)=>{const x=oe,W=me;return d(),c(S,null,[i(o)!==null?(d(),c("div",fe,[u("div",null,"We detected that the machine was "+g(i(l))+" between "+g(i(b))+" and "+g(i(p))+".",1),w[0]||(w[0]=u("div",null,"Why was that?",-1))])):h("",!0),i(o)===2?(d(),E(x,{key:1,reasons:i(m),onUpdate:y},null,8,["reasons"])):h("",!0),i(o)===3?(d(),E(x,{key:2,reasons:i($),onUpdate:y},null,8,["reasons"])):h("",!0),i(o)===4?(d(),E(x,{key:3,reasons:i(B),onUpdate:y},null,8,["reasons"])):h("",!0),i(o)===null?(d(),E(W,{key:4,reasons:[i(s),i(n),i(a)],l1:i(l),startTime:i(b),endTime:i(p),onConfirm:P,onRestart:R},null,8,["reasons","l1","startTime","endTime"])):h("",!0)],64)}}}),_e=window.setInterval,ve={class:"grid w-full gap-1 grid-rows-[auto_1fr] divide-y-4"},he={class:"grow bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4 w-fit m-auto my-28 text-lg"},we={key:0,class:"text-2xl text-center text-black"},ye={key:1,class:"text-2xl text-center text-black"},be={key:2,class:"text-2xl"},Re=1e3*60*10,Se=L({__name:"input",setup(e){const t=v(null),s=_(()=>t.value&&t.value.length>0?t.value[0]:null),n=v(null),a=_(()=>n.value&&n.value.length>0?n.value[0]:null),r=async()=>{const p=await Y();p!==null&&(t.value=p)},o=async()=>{const p=await j();p!==null&&(n.value=p)},l=async()=>{r(),o()};l(),U(()=>{_e(l,Re)});const m=()=>{t.value!==null&&t.value.shift()},b=()=>{var p;n&&((p=n.value)==null||p.shift())};return(p,P)=>{const R=ee,y=ge;return d(),c("div",ve,[u("div",he,[i(a)!==null?(d(),c("div",we,[A(R,{dateNeedingQualityInput:i(a),completed:b},null,8,["dateNeedingQualityInput"])])):i(s)!==null?(d(),c("div",ye,[A(y,{timespanRequiringLossReasons:i(s),completed:m},null,8,["timespanRequiringLossReasons"])])):(d(),c("div",be," All data is up to date. "))])])}}});export{Se as default};
